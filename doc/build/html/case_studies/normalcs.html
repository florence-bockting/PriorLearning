
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Case Study: Normal model &#8212; Make My Prior</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script src="../_static/documentation_options.js?v=3611b776"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'case_studies/normalcs';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">Make My Prior</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../MakeMyPrior.html">MakeMyPrior package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../case_studies.html">Case Studies</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/case_studies/normalcs.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Case Study: Normal model</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#user-specification">User specification</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-hyperparameter-for-the-learning-algorithm">Setting hyperparameter for the learning algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-design-matrix">Define the design matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-the-ideal-agent">Setup the ‘ideal agent’</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-data-generating-model">Define the data generating model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-the-target-quantities-and-the-elicitation-technique">Specify the target quantities and the elicitation technique</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expert-model">Expert model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expert-predictions">Expert predictions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-algorithm">Learning Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-results">Training results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#loss">Loss</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#learned-hyperparameter-values">Learned hyperparameter values</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">patsy</span> <span class="k">as</span> <span class="nn">pa</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow_probability</span> <span class="k">as</span> <span class="nn">tfp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">tfd</span> <span class="o">=</span> <span class="n">tfp</span><span class="o">.</span><span class="n">distributions</span>

<span class="kn">from</span> <span class="nn">MakeMyPrior.elicitation_wrapper</span> <span class="kn">import</span> <span class="n">expert_model</span>
<span class="kn">from</span> <span class="nn">MakeMyPrior.training</span> <span class="kn">import</span> <span class="n">trainer</span>
<span class="kn">from</span> <span class="nn">MakeMyPrior.helper_functions</span> <span class="kn">import</span> <span class="n">group_obs</span><span class="p">,</span> <span class="n">Exponential_unconstrained</span><span class="p">,</span> <span class="n">Normal_unconstrained</span>
<span class="kn">from</span> <span class="nn">MakeMyPrior.user_config</span> <span class="kn">import</span> <span class="n">target_config</span><span class="p">,</span> <span class="n">target_input</span>
<span class="kn">from</span> <span class="nn">MakeMyPrior.discrepancy_measures</span> <span class="kn">import</span> <span class="n">energy_loss</span>
<span class="kn">from</span> <span class="nn">MakeMyPrior.helper_functions</span> <span class="kn">import</span> <span class="n">print_restab</span><span class="p">,</span> <span class="n">plot_priors_hyp</span><span class="p">,</span> <span class="n">plot_expert_preds</span><span class="p">,</span> <span class="n">group_stats</span>
<span class="kn">import</span> <span class="nn">MakeMyPrior.combine_losses</span> 

<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">2024</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="case-study-normal-model">
<h1>Case Study: Normal model<a class="headerlink" href="#case-study-normal-model" title="Link to this heading">#</a></h1>
<p>\begin{align*}
y_i &amp;\sim \text{Normal}(\theta_i, s)\
\theta_i &amp;= \beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_3x_3 + \beta_4x_4 + \beta_5x_5\
\beta_k &amp;\sim \text{Normal}(\mu_k, \sigma_k) \quad \text{for }k=0,\ldots, 5\
s &amp;\sim \text{Exponential}(\nu)
\end{align*}</p>
<section id="user-specification">
<h2>User specification<a class="headerlink" href="#user-specification" title="Link to this heading">#</a></h2>
<section id="setting-hyperparameter-for-the-learning-algorithm">
<h3>Setting hyperparameter for the learning algorithm<a class="headerlink" href="#setting-hyperparameter-for-the-learning-algorithm" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># setting of hyperparameter of learning algorithm</span>
<span class="n">user_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>                    
        <span class="n">B</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span>                          
        <span class="n">rep</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>                         
        <span class="n">epochs</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>                      
        <span class="n">view_ep</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">lr_decay</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">lr0</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> 
        <span class="n">lr_min</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> 
        <span class="n">loss_dimensions</span> <span class="o">=</span> <span class="s2">&quot;m,n:B&quot;</span><span class="p">,</span>   
        <span class="n">loss_discrepancy</span> <span class="o">=</span> <span class="p">[</span><span class="n">energy_loss</span><span class="p">()]</span><span class="o">*</span><span class="mi">11</span><span class="p">,</span>       
        <span class="n">loss_scaling</span> <span class="o">=</span> <span class="s2">&quot;unscaled&quot;</span><span class="p">,</span>         
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;hyperparameter_learning&quot;</span>  
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-design-matrix">
<h3>Define the design matrix<a class="headerlink" href="#define-the-design-matrix" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># construct design matrix</span>
<span class="n">X</span> <span class="o">=</span>  <span class="n">pa</span><span class="o">.</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;a*b&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">balanced</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">repeat</span> <span class="o">=</span> <span class="mi">120</span><span class="p">),</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">)</span>
<span class="n">dmatrix</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="c1"># extract contrast matrix from design matrix (for allocating observations to groups)</span>
<span class="n">cmatrix</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">dmatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     Intercept  a[T.a2]  b[T.b2]  b[T.b3]  a[T.a2]:b[T.b2]  a[T.a2]:b[T.b3]
0          1.0      0.0      0.0      0.0              0.0              0.0
1          1.0      0.0      1.0      0.0              0.0              0.0
2          1.0      0.0      0.0      1.0              0.0              0.0
3          1.0      1.0      0.0      0.0              0.0              0.0
4          1.0      1.0      1.0      0.0              1.0              0.0
..         ...      ...      ...      ...              ...              ...
715        1.0      0.0      1.0      0.0              0.0              0.0
716        1.0      0.0      0.0      1.0              0.0              0.0
717        1.0      1.0      0.0      0.0              0.0              0.0
718        1.0      1.0      1.0      0.0              1.0              0.0
719        1.0      1.0      0.0      1.0              0.0              1.0

[720 rows x 6 columns]
</pre></div>
</div>
</div>
</div>
</section>
<section id="setup-the-ideal-agent">
<h3>Setup the ‘ideal agent’<a class="headerlink" href="#setup-the-ideal-agent" title="Link to this heading">#</a></h3>
<p>Define an ‘arbitrary’ ground truth for the hyperparameter values for method validation.</p>
<ol class="arabic simple">
<li><p>Define <em>true</em> hyperparameter values (for method validation; check recovery)</p></li>
<li><p>Specify for each model parameter:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">family</span></code>: prior distribution family</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">initialization</span></code>: initial hyperparameter value as starting point for the learning algorithm</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code>: prior distributions with true hyperparameter values as defined in 1.)</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># true hyperparameter values for ideal_expert</span>
<span class="n">true_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">true_values</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04</span><span class="p">]</span>
<span class="n">true_values</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">]</span>
<span class="n">true_values</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">9.</span>

<span class="c1"># model parameters</span>
<span class="n">parameters_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">parameters_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;beta_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;family&quot;</span><span class="p">:</span>  <span class="n">Normal_unconstrained</span><span class="p">(),</span>
            <span class="s2">&quot;true&quot;</span><span class="p">:</span> <span class="n">tfd</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">true_values</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">true_values</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
            <span class="s2">&quot;initialization&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">tfd</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span>
            <span class="p">}</span>

<span class="n">exp_dist</span> <span class="o">=</span> <span class="n">Exponential_unconstrained</span><span class="p">(</span><span class="n">user_config</span><span class="p">[</span><span class="s2">&quot;rep&quot;</span><span class="p">])</span>
<span class="n">parameters_dict</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="n">exp_dist</span><span class="p">,</span>
        <span class="s2">&quot;true&quot;</span><span class="p">:</span> <span class="n">exp_dist</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">true_values</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">])),</span>
        <span class="s2">&quot;initialization&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">tfd</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)]</span>
        <span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True hyperparameter values:&quot;</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">true_values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Specify prior distribution per model parameter:&quot;</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">parameters_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True hyperparameter values:
{&#39;mu&#39;: [0.12, 0.15, -0.02, -0.03, -0.02, -0.04],
 &#39;nu&#39;: 9.0,
 &#39;sigma&#39;: [0.02, 0.02, 0.06, 0.06, 0.03, 0.03]}

Specify prior distribution per model parameter:
{&#39;beta_0&#39;: {&#39;family&#39;: &lt;MakeMyPrior.helper_functions.Normal_unconstrained object at 0x00000234981521D0&gt;,
            &#39;initialization&#39;: [&lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;,
                               &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;],
            &#39;true&#39;: &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;},
 &#39;beta_1&#39;: {&#39;family&#39;: &lt;MakeMyPrior.helper_functions.Normal_unconstrained object at 0x0000023498016990&gt;,
            &#39;initialization&#39;: [&lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;,
                               &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;],
            &#39;true&#39;: &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;},
 &#39;beta_2&#39;: {&#39;family&#39;: &lt;MakeMyPrior.helper_functions.Normal_unconstrained object at 0x00000234B6026A50&gt;,
            &#39;initialization&#39;: [&lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;,
                               &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;],
            &#39;true&#39;: &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;},
 &#39;beta_3&#39;: {&#39;family&#39;: &lt;MakeMyPrior.helper_functions.Normal_unconstrained object at 0x000002352D53A150&gt;,
            &#39;initialization&#39;: [&lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;,
                               &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;],
            &#39;true&#39;: &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;},
 &#39;beta_4&#39;: {&#39;family&#39;: &lt;MakeMyPrior.helper_functions.Normal_unconstrained object at 0x00000235480B2110&gt;,
            &#39;initialization&#39;: [&lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;,
                               &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;],
            &#39;true&#39;: &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;},
 &#39;beta_5&#39;: {&#39;family&#39;: &lt;MakeMyPrior.helper_functions.Normal_unconstrained object at 0x00000235481D83D0&gt;,
            &#39;initialization&#39;: [&lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;,
                               &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;],
            &#39;true&#39;: &lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;},
 &#39;sigma&#39;: {&#39;family&#39;: &lt;MakeMyPrior.helper_functions.Exponential_unconstrained object at 0x00000235481D0250&gt;,
           &#39;initialization&#39;: [&lt;tfp.distributions.Normal &#39;Normal&#39; batch_shape=[] event_shape=[] dtype=float32&gt;],
           &#39;true&#39;: &lt;tfp.distributions.Gamma &#39;Gamma&#39; batch_shape=[] event_shape=[] dtype=float32&gt;}}
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-data-generating-model">
<h3>Define the data generating model<a class="headerlink" href="#define-the-data-generating-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generative model</span>
<span class="k">class</span> <span class="nc">GenerativeModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">parameters</span><span class="p">,</span> <span class="c1"># obligatory: samples from prior distributions; tf.Tensor</span>
                 <span class="n">dmatrix</span><span class="p">,</span>    <span class="c1"># optional: design matrix; tf.Tensor</span>
                 <span class="n">cmatrix</span><span class="p">,</span>    <span class="c1"># optional: contrast matrix; tf.Tensor</span>
                 <span class="o">**</span><span class="n">kwargs</span>    <span class="c1"># obligatory: possibility for further keyword arguments is needed </span>
                 <span class="p">):</span>  
        
        <span class="c1"># compute linear predictor term</span>
        <span class="n">epred</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">@</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">)</span>
        
        <span class="c1"># define likelihood</span>
        <span class="n">likelihood</span> <span class="o">=</span> <span class="n">tfd</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">epred</span><span class="p">,</span> 
            <span class="n">scale</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">parameters</span><span class="p">[:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="c1"># sample prior predictive data</span>
        <span class="n">ypred</span> <span class="o">=</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        
        <span class="c1"># compute custom target quantity (here: group-differences)</span>
        <span class="n">samples_grouped</span> <span class="o">=</span> <span class="n">group_obs</span><span class="p">(</span><span class="n">ypred</span><span class="p">,</span> <span class="n">dmatrix</span><span class="p">,</span> <span class="n">cmatrix</span><span class="p">)</span>

        <span class="c1"># compute mean difference between groups</span>
        <span class="n">effect_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diffs</span><span class="p">)):</span>
            <span class="c1"># compute group difference</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span>
                <span class="n">samples_grouped</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                <span class="n">samples_grouped</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">diffs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="c1"># average over individual obs within each group</span>
            <span class="n">diff_mean</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># collect all mean group differences</span>
            <span class="n">effect_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff_mean</span><span class="p">)</span>

        <span class="n">mean_effects</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">effect_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span><span class="p">,</span>      <span class="c1"># obligatory: likelihood; callable</span>
                    <span class="n">ypred</span> <span class="o">=</span> <span class="n">ypred</span><span class="p">,</span>                <span class="c1"># obligatory: prior predictive data</span>
                    <span class="n">epred</span> <span class="o">=</span> <span class="n">epred</span><span class="p">,</span>                <span class="c1"># obligatory: samples from linear predictor</span>
                    <span class="n">mean_effects</span> <span class="o">=</span> <span class="n">mean_effects</span>   <span class="c1"># optional: custom target quantity</span>
                    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="specify-the-target-quantities-and-the-elicitation-technique">
<h3>Specify the target quantities and the elicitation technique<a class="headerlink" href="#specify-the-target-quantities-and-the-elicitation-technique" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="c1"># define a custom function using the output from the generative model   </span>
<span class="k">def</span> <span class="nf">custom_r2</span><span class="p">(</span><span class="n">ypred</span><span class="p">,</span> <span class="n">epred</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_variance</span><span class="p">(</span><span class="n">epred</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> 
                          <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_variance</span><span class="p">(</span><span class="n">ypred</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># specify target quantity, elicitation technique and loss combination</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">target_config</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> 
                   <span class="n">elicitation</span><span class="o">=</span><span class="s2">&quot;histogram&quot;</span><span class="p">,</span>
                   <span class="n">combine_loss</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
                   <span class="n">custom_target_function</span> <span class="o">=</span> <span class="n">custom_r2</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">target_config</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;group_means&quot;</span><span class="p">,</span> 
                   <span class="n">elicitation</span><span class="o">=</span><span class="s2">&quot;quantiles&quot;</span><span class="p">,</span> 
                   <span class="n">combine_loss</span><span class="o">=</span><span class="s2">&quot;by-group&quot;</span><span class="p">,</span> 
                   <span class="n">quantiles_specs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
<span class="n">t3</span> <span class="o">=</span> <span class="n">target_config</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;mean_effects&quot;</span><span class="p">,</span> 
                   <span class="n">elicitation</span><span class="o">=</span><span class="s2">&quot;quantiles&quot;</span><span class="p">,</span>
                   <span class="n">combine_loss</span><span class="o">=</span><span class="s2">&quot;by-group&quot;</span><span class="p">,</span>
                   <span class="n">quantiles_specs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
<span class="n">t4</span> <span class="o">=</span> <span class="n">target_config</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;grand_mean&quot;</span><span class="p">,</span> 
                   <span class="n">elicitation</span><span class="o">=</span><span class="s2">&quot;histogram&quot;</span><span class="p">,</span>
                   <span class="n">combine_loss</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span> 

<span class="n">target_info</span> <span class="o">=</span> <span class="n">target_input</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">)</span>

<span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">target_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;combine_loss&#39;: [&#39;all&#39;, &#39;by-group&#39;, &#39;by-group&#39;],
 &#39;custom_target_function&#39;: [&lt;function custom_r2 at 0x00000234EB4949A0&gt;,
                            None,
                            None],
 &#39;elicitation&#39;: [&#39;histogram&#39;, &#39;quantiles&#39;, &#39;quantiles&#39;],
 &#39;internal_loss&#39;: [None, None, None],
 &#39;quantiles_specs&#39;: [(10, 20, 30, 40, 50, 60, 70, 80, 90),
                     (10, 20, 30, 40, 50, 60, 70, 80, 90)],
 &#39;target&#39;: [&#39;R2&#39;, &#39;group_means&#39;, &#39;mean_effects&#39;]}
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="expert-model">
<h2>Expert model<a class="headerlink" href="#expert-model" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expert_res_list</span><span class="p">,</span> <span class="n">prior_pred_res</span> <span class="o">=</span> <span class="n">expert_model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_config</span><span class="p">[</span><span class="s2">&quot;rep&quot;</span><span class="p">],</span>
                                   <span class="n">parameters_dict</span><span class="p">,</span> <span class="n">GenerativeModel</span><span class="p">,</span> <span class="n">target_info</span><span class="p">,</span>
                                   <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;ideal_expert&quot;</span><span class="p">,</span>
                                   <span class="n">dmatrix</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">,</span>
                                   <span class="n">cmatrix</span> <span class="o">=</span> <span class="n">cmatrix</span><span class="p">,</span>
                                   <span class="n">dmatrix_fct</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">)</span>

<span class="c1"># elicited statistics from the (ideal) expert</span>
<span class="n">expert_res_list</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;R2_hist_0&#39;, &#39;group_means_quant_1&#39;, &#39;mean_effects_quant_2&#39;])
</pre></div>
</div>
</div>
</div>
<section id="expert-predictions">
<h3>Expert predictions<a class="headerlink" href="#expert-predictions" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># group means</span>
<span class="nb">print</span><span class="p">(</span><span class="n">group_stats</span><span class="p">(</span><span class="n">prior_pred_res</span><span class="p">[</span><span class="s2">&quot;ypred&quot;</span><span class="p">],</span> <span class="n">num_groups</span> <span class="o">=</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># mean effects</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean effects:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">prior_pred_res</span><span class="p">[</span><span class="s2">&quot;mean_effects&quot;</span><span class="p">],(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------+------+
| group | mean | std  |
+-------+------+------+
|  gr_0 | 0.12 | 0.02 |
|  gr_1 | 0.1  | 0.06 |
|  gr_2 | 0.09 | 0.07 |
|  gr_3 | 0.27 | 0.03 |
|  gr_4 | 0.22 | 0.07 |
|  gr_5 | 0.2  | 0.08 |
+-------+------+------+
mean effects:
[0.15 0.13 0.11]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot expert predictions</span>
<span class="n">plot_expert_preds</span><span class="p">(</span><span class="n">expert_res_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\flobo\MakeMyPrior\MakeMyPrior\helper_functions.py:417: UserWarning: FixedFormatter should only be used together with FixedLocator
  axs[0].set_yticklabels([&quot;r&quot;,&quot;new: deep&quot;,&quot;new: standard&quot;,&quot;new: shallow&quot;,&quot;rep: deep&quot;,&quot;rep: standard&quot;,&quot;rep: shallow&quot;])
</pre></div>
</div>
<img alt="../_images/f2fbd34ed141a4487eead7ddbe52a7a97ffd875f475e8fb79282f2ea55ca5269.png" src="../_images/f2fbd34ed141a4487eead7ddbe52a7a97ffd875f475e8fb79282f2ea55ca5269.png" />
</div>
</div>
</section>
</section>
<section id="learning-algorithm">
<h2>Learning Algorithm<a class="headerlink" href="#learning-algorithm" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_dict</span> <span class="o">=</span> <span class="n">trainer</span><span class="p">(</span><span class="n">expert_res_list</span><span class="p">,</span> <span class="n">user_config</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">],</span> <span class="n">user_config</span><span class="p">[</span><span class="s2">&quot;rep&quot;</span><span class="p">],</span>
                   <span class="n">parameters_dict</span><span class="p">,</span> <span class="n">user_config</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">GenerativeModel</span><span class="p">,</span>
                   <span class="n">target_info</span><span class="p">,</span> <span class="n">user_config</span><span class="p">,</span> <span class="n">loss_balancing</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save_vals</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;prior_preds&quot;</span><span class="p">],</span>
                   <span class="n">dmatrix</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">,</span> <span class="n">cmatrix</span> <span class="o">=</span> <span class="n">cmatrix</span><span class="p">,</span> <span class="n">dmatrix_fct</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>epoch_time: 1062.938ms
Epoch: 0, loss: 0.80136, lr: 0.100000
epoch_time: 244.903ms
Epoch: 30, loss: 0.12183, lr: 0.053144
epoch_time: 282.745ms
Epoch: 60, loss: 0.04244, lr: 0.028243
epoch_time: 267.483ms
Epoch: 90, loss: 0.02091, lr: 0.015009
epoch_time: 264.304ms
Epoch: 120, loss: 0.01540, lr: 0.007977
epoch_time: 259.083ms
Epoch: 150, loss: 0.01767, lr: 0.004239
epoch_time: 273.342ms
Epoch: 180, loss: 0.02404, lr: 0.002253
epoch_time: 257.814ms
Epoch: 210, loss: 0.01377, lr: 0.001197
epoch_time: 267.489ms
Epoch: 240, loss: 0.01493, lr: 0.000636
epoch_time: 286.409ms
Epoch: 270, loss: 0.01584, lr: 0.000338
</pre></div>
</div>
</div>
</div>
<section id="training-results">
<h3>Training results<a class="headerlink" href="#training-results" title="Link to this heading">#</a></h3>
<section id="loss">
<h4>Loss<a class="headerlink" href="#loss" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;loss_info&quot;</span><span class="p">])),</span> <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;loss_info&quot;</span><span class="p">])</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;epochs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;energy loss (weighted sum)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f7c1f1d2628e58fdbe411a86884c48ec262f76889cbe990046f2d7d4a5debd1d.png" src="../_images/f7c1f1d2628e58fdbe411a86884c48ec262f76889cbe990046f2d7d4a5debd1d.png" />
</div>
</div>
</section>
<section id="learned-hyperparameter-values">
<h4>Learned hyperparameter values<a class="headerlink" href="#learned-hyperparameter-values" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">true_values</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span><span class="n">true_values</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>
<span class="n">true_vals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">true_values</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">]]</span>

<span class="n">tab</span><span class="p">,</span> <span class="n">avg_res</span> <span class="o">=</span> <span class="n">print_restab</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;hyperparameter_learning&quot;</span><span class="p">,</span> 
                             <span class="n">num_vars</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> 
                             <span class="n">res</span> <span class="o">=</span> <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;hyperparam_info&quot;</span><span class="p">],</span> 
                             <span class="n">start</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
                             <span class="n">precision</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                             <span class="n">true_values</span> <span class="o">=</span> <span class="n">true_vals</span><span class="p">)</span>
<span class="n">tab</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>var_name</th>
            <th>pred mean</th>
            <th>pred std</th>
            <th>true</th>
            <th>err</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>loc_0</td>
            <td>0.12</td>
            <td>0.006</td>
            <td>0.12</td>
            <td>0.0</td>
        </tr>
        <tr>
            <td>scale_0</td>
            <td>0.024</td>
            <td>0.0</td>
            <td>0.02</td>
            <td>0.004</td>
        </tr>
        <tr>
            <td>loc_1</td>
            <td>0.148</td>
            <td>0.007</td>
            <td>0.15</td>
            <td>0.002</td>
        </tr>
        <tr>
            <td>scale_1</td>
            <td>0.023</td>
            <td>0.0</td>
            <td>0.02</td>
            <td>0.003</td>
        </tr>
        <tr>
            <td>loc_2</td>
            <td>-0.027</td>
            <td>0.006</td>
            <td>-0.02</td>
            <td>0.007</td>
        </tr>
        <tr>
            <td>scale_2</td>
            <td>0.062</td>
            <td>0.0</td>
            <td>0.06</td>
            <td>0.002</td>
        </tr>
        <tr>
            <td>loc_3</td>
            <td>-0.033</td>
            <td>0.006</td>
            <td>-0.03</td>
            <td>0.003</td>
        </tr>
        <tr>
            <td>scale_3</td>
            <td>0.064</td>
            <td>0.0</td>
            <td>0.06</td>
            <td>0.004</td>
        </tr>
        <tr>
            <td>loc_4</td>
            <td>-0.022</td>
            <td>0.006</td>
            <td>-0.02</td>
            <td>0.002</td>
        </tr>
        <tr>
            <td>scale_4</td>
            <td>0.031</td>
            <td>0.0</td>
            <td>0.03</td>
            <td>0.001</td>
        </tr>
        <tr>
            <td>loc_5</td>
            <td>-0.041</td>
            <td>0.006</td>
            <td>-0.04</td>
            <td>0.001</td>
        </tr>
        <tr>
            <td>scale_5</td>
            <td>0.031</td>
            <td>0.0</td>
            <td>0.03</td>
            <td>0.001</td>
        </tr>
        <tr>
            <td>rate_6</td>
            <td>8.838</td>
            <td>0.019</td>
            <td>9.0</td>
            <td>0.162</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_priors_hyp</span><span class="p">(</span><span class="n">avg_res</span><span class="p">,</span> <span class="n">true_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8f98ee7bd586005dc6fda6cf709dff26dcd276c5d3fea35b8de85cd9300a9a2d.png" src="../_images/8f98ee7bd586005dc6fda6cf709dff26dcd276c5d3fea35b8de85cd9300a9a2d.png" />
</div>
</div>
</section>
</section>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#user-specification">User specification</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-hyperparameter-for-the-learning-algorithm">Setting hyperparameter for the learning algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-design-matrix">Define the design matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-the-ideal-agent">Setup the ‘ideal agent’</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-data-generating-model">Define the data generating model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-the-target-quantities-and-the-elicitation-technique">Specify the target quantities and the elicitation technique</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expert-model">Expert model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expert-predictions">Expert predictions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-algorithm">Learning Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-results">Training results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#loss">Loss</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#learned-hyperparameter-values">Learned hyperparameter values</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Florence Bockting
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024, Florence Bockting.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>